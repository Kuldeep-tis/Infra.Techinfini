<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" 
          content="width=device-width, initial-scale=1.0">
    <title>Dropdown Search</title>
    <style>
         form {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-width: 800px;
            margin: 20px auto;
            
            
        }



    .login-box {
      
      padding: 10px;
      
      border-radius: 8px;
      
      text-align: center;
    }

    .login-box input,select {
      width: 20%;
      padding: 7px;
      margin: 10px 0;
      border-radius: 5px;
      border-color: black;
    }



    

    .login-box a {
      display: block;
      margin-top: 15px;
      color: black
    }
    </style>
</head>

<body>


         {% include 'test_app/navbar.html' %}
    <a href="/repair-table"><input type="submit" value="Back" style="margin-top: 20px; width: 70px; border-radius: 5px; border-color: white; padding: 5px; background-color: black; color: white;"></a>


      {% if msg %}
      <p style="text-align: center; color: red;">{{msg}}</p>
      {% endif %}
    
        

<form class="login-box" action="{% url 'add-repair' %}" method="POST">
    {% csrf_token %}
    

    <h2>Repair Details</h2>

<div style="display: flex;">
  <div>
    {% if flag %}

    {% else %}
     <input type="text"  id="dropdownSearch"   placeholder="Search..." style="width: 150px;  margin-left: 70px; padding: 1px; border-radius: 0px; margin-top: 20px;" >
     {% endif %}
  </div>
  <div>
    {% if flag %}

    {% else %}
     <button type="button" onclick="search()" style="margin-top: 20px; width: 60px; padding: 1px;"  >search</button>
     {% endif %}

  </div>
</div>


{% if flag %}
<div style="display: flex;  gap: 15rem; ">
    <div>
     <label>Tool Id:</label>
     <input  style="width: 200px; margin-left: 55px; padding: 8px; text-transform: capitalize;" readonly value="{{name}}({{tool_id}})">
     <input type="hidden" name="tool_id" value="{{tool_id}}">
    </div>
  <div>
     <label>Repair Cost</label><br>
    <input type="number"  name="cost" value="{{cost}}" required style="width: 205px; margin-right: 30px;"><br><br>
  </div>
</div>
{% else %}
<div style="display: flex;  gap: 16rem; ">
           <div>

            <select id="showDropdown" name="tool_id" onclick="valueSelected()" style="width: 220px; margin-left: 70px; padding: 8px; text-transform: capitalize; margin-top: 30px;" >



                      {% for k in data %}
                           <option value="{{k.tool_id}}" id="option"  >{{k.tool_name}} ({{k.tool_id}})</option>
                      {% endfor %}
                    </select>
                    
           </div>
          <div>
    <label>Repair Cost</label><br>
    <input type="number"  name="cost" value="{{cost}}" required style="width: 205px; margin-right: 10px;"><br><br>

    </div>
</div>
{% endif %}

<div style="display: flex; gap: 16rem;">
  <div>
    <label style="margin-left: 55px;">Return Date</label><br>
    <input type="date"  name="date"  required style=" padding: 8px; width: 200px; margin-left: 70px;"><br><br>
  </div>
   <div>
    <label>Repair Person</label><br>
    <input type="text"  name="repair_person" value="{{repair_person}}" required style="width: 206px;"><br><br>
   </div>
</div>

    

    
    <button type="submit" style="     padding: 10px 20px;
      background-color: black;
      color: white;"  >Submit</button>


</form>




      </body>
    <script>

    function valueSelected(id){
      const input=document.getElementById('showDropdown')
      console.log(input.value)
      const tool=document.getElementById('dropdownSearch')
     tool.value=input.value
    }
        
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
      
    

        function search(){
          const value=document.getElementById('dropdownSearch')
          console.log(value.value)
          fetch('/search-repair/',{
                method :'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': getCookie('csrftoken'),
                },
                body : JSON.stringify({'search':value.value}),

          })
              .then(response => response.json())
              .then(data => {
                console.log('hello')

                const dropdown = document.getElementById('showDropdown');
                dropdown.innerHTML=''
                for (let i = 0; i < data.length; i++) {
                    const option = document.createElement('option');
                    option.textContent = data[i]['tool_name']+"("+data[i]['tool_id']+")"
                    option.value = data[i]['tool_id']
                    console.log(data[i]['tool_id'])
                    dropdown.appendChild(option);
                  }
                      })
          }
 

        </script>
      
</body>

</html>